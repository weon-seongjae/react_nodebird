{"ast":null,"code":"import _regeneratorRuntime from \"@babel/runtime-corejs2/regenerator\";\nimport _asyncToGenerator from \"@babel/runtime-corejs2/helpers/esm/asyncToGenerator\";\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport withRedux from 'next-redux-wrapper';\nimport withReduxSaga from 'next-redux-saga'; // 서버사이드 렌더링에 필수요소\n\nimport { applyMiddleware, compose, createStore } from 'redux';\nimport { Provider } from 'react-redux';\nimport createSagaMiddleware from 'redux-saga';\nimport axios from 'axios';\nimport Helmet from 'react-helmet';\nimport { Container } from 'next/app';\nimport AppLayout from '../components/AppLayout';\nimport reducer from '../reducers';\nimport rootSaga from '../sagas';\nimport Home from './index';\nimport { LOAD_USER_REQUEST } from '../reducers/user';\n\nvar NodeBird = function NodeBird(_ref) {\n  var Component = _ref.Component,\n      store = _ref.store,\n      pageProps = _ref.pageProps;\n  return (// hashtag의 component의 props로 넣어줌.\n    React.createElement(Container, null, React.createElement(Provider, {\n      store: store\n    }, React.createElement(Helmet, {\n      title: \"NodeBird\",\n      htmlAttributes: {\n        lang: 'ko'\n      },\n      meta: [{\n        charset: 'UTF-8'\n      }, {\n        name: 'viewport',\n        content: 'width=device-width, initial-scale=1.0. minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes,viewport-fit=cover'\n      }, {\n        'http-equiv': 'X-UA-Compatible',\n        content: 'IE=edge'\n      }, {\n        name: 'description',\n        content: 'weonsj의 NodeBird SNS'\n      }, {\n        name: 'og:title',\n        content: 'NodeBird'\n      }, {\n        name: 'og:description',\n        content: 'weonsj의 NodeBird SNS'\n      }, {\n        property: 'og:type',\n        content: 'website'\n      }],\n      link: [{\n        rel: 'stylesheet',\n        href: 'https://cdnjs.cloudflare.com/ajax/libs/antd/3.16.2/antd.css'\n      }, {\n        rel: 'stylesheet',\n        href: 'https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.min.css'\n      }, {\n        rel: 'stylesheet',\n        href: 'https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick-theme.min.css'\n      }],\n      script: [{\n        src: 'https://cdnjs.cloudflare.com/ajax/libs/antd/3.16.2/antd.js'\n      }]\n    }), React.createElement(AppLayout, null, React.createElement(Component, pageProps))))\n  );\n};\n\nNodeBird.propTypes = {\n  Component: PropTypes.elementType.isRequired,\n  store: PropTypes.object.isRequired,\n  pageProps: PropTypes.object.isRequired\n}; // const middleware = (store) => (next) => (action) => {\n//   next(action);\n// };\n//= =====middleware만드는 방법 : currying - 인자 하나를 받아 다른 함수를 리턴\n// ==================next에서 getInitialProps 실행. context도 같이 넣어줌. 이것에 각 Component에서 실행됨.===============\n\nNodeBird.getInitialProps =\n/*#__PURE__*/\nfunction () {\n  var _ref2 = _asyncToGenerator(\n  /*#__PURE__*/\n  _regeneratorRuntime.mark(function _callee(context) {\n    var ctx, Component, pageProps, state, cookie;\n    return _regeneratorRuntime.wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            ctx = context.ctx, Component = context.Component;\n            pageProps = {};\n            state = ctx.store.getState(); // user 정보 가져옴, user 정보도 서버사이드 렌더링 구현됨\n\n            cookie = ctx.isServer ? ctx.req.headers.cookie : ''; // 쿠키가 위치하는 곳\n\n            axios.defaults.headers.Cookie = '';\n\n            if (ctx.isServer) {\n              axios.defaults.headers.Cookie = cookie; // 직접 쿠키를 넣어줌.\n            }\n\n            if (!state.user.me) {\n              ctx.store.dispatch({\n                type: LOAD_USER_REQUEST\n              });\n            }\n\n            if (!Component.getInitialProps) {\n              _context.next = 11;\n              break;\n            }\n\n            _context.next = 10;\n            return Component.getInitialProps(ctx);\n\n          case 10:\n            pageProps = _context.sent;\n\n          case 11:\n            return _context.abrupt(\"return\", {\n              pageProps: pageProps\n            });\n\n          case 12:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee);\n  }));\n\n  return function (_x) {\n    return _ref2.apply(this, arguments);\n  };\n}(); // =================================================================================\n\n\nvar configureStore = function configureStore(initialState, options) {\n  var sagaMiddleware = createSagaMiddleware();\n  var middlewares = [sagaMiddleware];\n  var enhancer = process.env.NODE_ENV === 'production' // 실제 서비스\n  ? compose(applyMiddleware.apply(void 0, middlewares)) : compose(applyMiddleware.apply(void 0, middlewares), !options.isServer && typeof window.__REDUX_DEVTOOLS_EXTENSION__ !== 'undefined' ? window.__REDUX_DEVTOOLS_EXTENSION__() : function (f) {\n    return f;\n  });\n  var store = createStore(reducer, initialState, enhancer);\n  store.sagaTask = sagaMiddleware.run(rootSaga); // 서버사이드 렌더링할 때 store.sagaTask를 변수로 설정. withReduxSaga가 내부에서 필요로 함\n\n  return store;\n};\n\nexport default withRedux(configureStore)(withReduxSaga(NodeBird)); // 레이아웃은 _app.js에서 코딩을 한다.","map":{"version":3,"sources":["C:\\react-nodebird\\ch7\\front\\pages\\_app.js"],"names":["React","PropTypes","withRedux","withReduxSaga","applyMiddleware","compose","createStore","Provider","createSagaMiddleware","axios","Helmet","Container","AppLayout","reducer","rootSaga","Home","LOAD_USER_REQUEST","NodeBird","Component","store","pageProps","lang","charset","name","content","property","rel","href","src","propTypes","elementType","isRequired","object","getInitialProps","context","ctx","state","getState","cookie","isServer","req","headers","defaults","Cookie","user","me","dispatch","type","configureStore","initialState","options","sagaMiddleware","middlewares","enhancer","process","env","NODE_ENV","window","__REDUX_DEVTOOLS_EXTENSION__","f","sagaTask","run"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,OAAOC,SAAP,MAAsB,oBAAtB;AACA,OAAOC,aAAP,MAA0B,iBAA1B,C,CAA6C;;AAC7C,SAASC,eAAT,EAA0BC,OAA1B,EAAmCC,WAAnC,QAAsD,OAAtD;AACA,SAASC,QAAT,QAAyB,aAAzB;AACA,OAAOC,oBAAP,MAAiC,YAAjC;AACA,OAAOC,KAAP,MAAkB,OAAlB;AACA,OAAOC,MAAP,MAAmB,cAAnB;AACA,SAASC,SAAT,QAA0B,UAA1B;AAEA,OAAOC,SAAP,MAAsB,yBAAtB;AACA,OAAOC,OAAP,MAAoB,aAApB;AACA,OAAOC,QAAP,MAAqB,UAArB;AACA,OAAOC,IAAP,MAAiB,SAAjB;AACA,SAASC,iBAAT,QAAkC,kBAAlC;;AAEA,IAAMC,QAAQ,GAAG,SAAXA,QAAW;AAAA,MAAGC,SAAH,QAAGA,SAAH;AAAA,MAAcC,KAAd,QAAcA,KAAd;AAAA,MAAqBC,SAArB,QAAqBA,SAArB;AAAA,SAAuC;AACtD,wBAAC,SAAD,QACE,oBAAC,QAAD;AAAU,MAAA,KAAK,EAAED;AAAjB,OACE,oBAAC,MAAD;AACE,MAAA,KAAK,EAAC,UADR;AAEE,MAAA,cAAc,EAAE;AAAEE,QAAAA,IAAI,EAAE;AAAR,OAFlB;AAGE,MAAA,IAAI,EAAE,CAAC;AACLC,QAAAA,OAAO,EAAE;AADJ,OAAD,EAEH;AACDC,QAAAA,IAAI,EAAE,UADL;AACiBC,QAAAA,OAAO,EAAE;AAD1B,OAFG,EAIH;AACD,sBAAc,iBADb;AACgCA,QAAAA,OAAO,EAAE;AADzC,OAJG,EAMH;AACDD,QAAAA,IAAI,EAAE,aADL;AACoBC,QAAAA,OAAO,EAAE;AAD7B,OANG,EAQH;AACDD,QAAAA,IAAI,EAAE,UADL;AACiBC,QAAAA,OAAO,EAAE;AAD1B,OARG,EAUH;AACDD,QAAAA,IAAI,EAAE,gBADL;AACuBC,QAAAA,OAAO,EAAE;AADhC,OAVG,EAYH;AACDC,QAAAA,QAAQ,EAAE,SADT;AACoBD,QAAAA,OAAO,EAAE;AAD7B,OAZG,CAHR;AAkBE,MAAA,IAAI,EAAE,CAAC;AACLE,QAAAA,GAAG,EAAE,YADA;AACcC,QAAAA,IAAI,EAAE;AADpB,OAAD,EAEH;AACDD,QAAAA,GAAG,EAAE,YADJ;AACkBC,QAAAA,IAAI,EAAE;AADxB,OAFG,EAIH;AACDD,QAAAA,GAAG,EAAE,YADJ;AACkBC,QAAAA,IAAI,EAAE;AADxB,OAJG,CAlBR;AAyBE,MAAA,MAAM,EAAE,CAAC;AACPC,QAAAA,GAAG,EAAE;AADE,OAAD;AAzBV,MADF,EA8BE,oBAAC,SAAD,QACE,oBAAC,SAAD,EAAeR,SAAf,CADF,CA9BF,CADF;AADe;AAAA,CAAjB;;AAuCAH,QAAQ,CAACY,SAAT,GAAqB;AACnBX,EAAAA,SAAS,EAAEjB,SAAS,CAAC6B,WAAV,CAAsBC,UADd;AAEnBZ,EAAAA,KAAK,EAAElB,SAAS,CAAC+B,MAAV,CAAiBD,UAFL;AAGnBX,EAAAA,SAAS,EAAEnB,SAAS,CAAC+B,MAAV,CAAiBD;AAHT,CAArB,C,CAMA;AACA;AACA;AACA;AAEA;;AACAd,QAAQ,CAACgB,eAAT;AAAA;AAAA;AAAA;AAAA;AAAA,2BAA2B,iBAAOC,OAAP;AAAA;AAAA;AAAA;AAAA;AAAA;AACjBC,YAAAA,GADiB,GACED,OADF,CACjBC,GADiB,EACZjB,SADY,GACEgB,OADF,CACZhB,SADY;AAErBE,YAAAA,SAFqB,GAET,EAFS;AAGnBgB,YAAAA,KAHmB,GAGXD,GAAG,CAAChB,KAAJ,CAAUkB,QAAV,EAHW,EAGW;;AAC9BC,YAAAA,MAJmB,GAIVH,GAAG,CAACI,QAAJ,GAAeJ,GAAG,CAACK,GAAJ,CAAQC,OAAR,CAAgBH,MAA/B,GAAwC,EAJ9B,EAIkC;;AAC3D7B,YAAAA,KAAK,CAACiC,QAAN,CAAeD,OAAf,CAAuBE,MAAvB,GAAgC,EAAhC;;AACA,gBAAIR,GAAG,CAACI,QAAR,EAAkB;AAChB9B,cAAAA,KAAK,CAACiC,QAAN,CAAeD,OAAf,CAAuBE,MAAvB,GAAgCL,MAAhC,CADgB,CACwB;AACzC;;AACD,gBAAI,CAACF,KAAK,CAACQ,IAAN,CAAWC,EAAhB,EAAoB;AAClBV,cAAAA,GAAG,CAAChB,KAAJ,CAAU2B,QAAV,CAAmB;AACjBC,gBAAAA,IAAI,EAAE/B;AADW,eAAnB;AAGD;;AAbwB,iBAcrBE,SAAS,CAACe,eAdW;AAAA;AAAA;AAAA;;AAAA;AAAA,mBAeLf,SAAS,CAACe,eAAV,CAA0BE,GAA1B,CAfK;;AAAA;AAevBf,YAAAA,SAfuB;;AAAA;AAAA,6CAiBlB;AAAEA,cAAAA,SAAS,EAATA;AAAF,aAjBkB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,GAA3B;;AAAA;AAAA;AAAA;AAAA,I,CAmBA;;;AAEA,IAAM4B,cAAc,GAAG,SAAjBA,cAAiB,CAACC,YAAD,EAAeC,OAAf,EAA2B;AAChD,MAAMC,cAAc,GAAG3C,oBAAoB,EAA3C;AACA,MAAM4C,WAAW,GAAG,CAACD,cAAD,CAApB;AACA,MAAME,QAAQ,GAAGC,OAAO,CAACC,GAAR,CAAYC,QAAZ,KAAyB,YAAzB,CAAsC;AAAtC,IACbnD,OAAO,CAACD,eAAe,MAAf,SAAmBgD,WAAnB,CAAD,CADM,GAEb/C,OAAO,CACPD,eAAe,MAAf,SAAmBgD,WAAnB,CADO,EAEP,CAACF,OAAO,CAACX,QAAT,IAAqB,OAAOkB,MAAM,CAACC,4BAAd,KAA+C,WAApE,GAAkFD,MAAM,CAACC,4BAAP,EAAlF,GAA0H,UAAAC,CAAC;AAAA,WAAIA,CAAJ;AAAA,GAFpH,CAFX;AAMA,MAAMxC,KAAK,GAAGb,WAAW,CAACO,OAAD,EAAUoC,YAAV,EAAwBI,QAAxB,CAAzB;AACAlC,EAAAA,KAAK,CAACyC,QAAN,GAAiBT,cAAc,CAACU,GAAf,CAAmB/C,QAAnB,CAAjB,CAVgD,CAUD;;AAC/C,SAAOK,KAAP;AACD,CAZD;;AAcA,eAAejB,SAAS,CAAC8C,cAAD,CAAT,CAA0B7C,aAAa,CAACc,QAAD,CAAvC,CAAf,C,CAEA","sourcesContent":["import React from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport withRedux from 'next-redux-wrapper';\r\nimport withReduxSaga from 'next-redux-saga'; // 서버사이드 렌더링에 필수요소\r\nimport { applyMiddleware, compose, createStore } from 'redux';\r\nimport { Provider } from 'react-redux';\r\nimport createSagaMiddleware from 'redux-saga';\r\nimport axios from 'axios';\r\nimport Helmet from 'react-helmet';\r\nimport { Container } from 'next/app';\r\n\r\nimport AppLayout from '../components/AppLayout';\r\nimport reducer from '../reducers';\r\nimport rootSaga from '../sagas';\r\nimport Home from './index';\r\nimport { LOAD_USER_REQUEST } from '../reducers/user';\r\n\r\nconst NodeBird = ({ Component, store, pageProps }) => ( // hashtag의 component의 props로 넣어줌.\r\n  <Container>\r\n    <Provider store={store}>\r\n      <Helmet\r\n        title=\"NodeBird\"\r\n        htmlAttributes={{ lang: 'ko' }}\r\n        meta={[{\r\n          charset: 'UTF-8',\r\n        }, {\r\n          name: 'viewport', content: 'width=device-width, initial-scale=1.0. minimum-scale=1.0, maximum-scale=1.0, user-scalable=yes,viewport-fit=cover',\r\n        }, {\r\n          'http-equiv': 'X-UA-Compatible', content: 'IE=edge',\r\n        }, {\r\n          name: 'description', content: 'weonsj의 NodeBird SNS',\r\n        }, {\r\n          name: 'og:title', content: 'NodeBird',\r\n        }, {\r\n          name: 'og:description', content: 'weonsj의 NodeBird SNS',\r\n        }, {\r\n          property: 'og:type', content: 'website',\r\n        }]}\r\n        link={[{\r\n          rel: 'stylesheet', href: 'https://cdnjs.cloudflare.com/ajax/libs/antd/3.16.2/antd.css',\r\n        }, {\r\n          rel: 'stylesheet', href: 'https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick.min.css',\r\n        }, {\r\n          rel: 'stylesheet', href: 'https://cdnjs.cloudflare.com/ajax/libs/slick-carousel/1.6.0/slick-theme.min.css',\r\n        }]}\r\n        script={[{\r\n          src: 'https://cdnjs.cloudflare.com/ajax/libs/antd/3.16.2/antd.js',\r\n        }]}\r\n      />\r\n      <AppLayout>\r\n        <Component {...pageProps} />\r\n      </AppLayout>\r\n    </Provider>\r\n  </Container>\r\n);\r\n\r\nNodeBird.propTypes = {\r\n  Component: PropTypes.elementType.isRequired,\r\n  store: PropTypes.object.isRequired,\r\n  pageProps: PropTypes.object.isRequired,\r\n};\r\n\r\n// const middleware = (store) => (next) => (action) => {\r\n//   next(action);\r\n// };\r\n//= =====middleware만드는 방법 : currying - 인자 하나를 받아 다른 함수를 리턴\r\n\r\n// ==================next에서 getInitialProps 실행. context도 같이 넣어줌. 이것에 각 Component에서 실행됨.===============\r\nNodeBird.getInitialProps = async (context) => {\r\n  const { ctx, Component } = context;\r\n  let pageProps = {};\r\n  const state = ctx.store.getState(); // user 정보 가져옴, user 정보도 서버사이드 렌더링 구현됨\r\n  const cookie = ctx.isServer ? ctx.req.headers.cookie : ''; // 쿠키가 위치하는 곳\r\n  axios.defaults.headers.Cookie = '';\r\n  if (ctx.isServer) {\r\n    axios.defaults.headers.Cookie = cookie; // 직접 쿠키를 넣어줌.\r\n  }\r\n  if (!state.user.me) {\r\n    ctx.store.dispatch({\r\n      type: LOAD_USER_REQUEST,\r\n    });\r\n  }\r\n  if (Component.getInitialProps) {\r\n    pageProps = await Component.getInitialProps(ctx); // hashtag.js에서 리턴한 값이 pageProps에 담김. pageProps는 위의 NodeBird의 pageProps로 넘김, index.js의 Home.getInitialProps = async (context)가 됨. 게시글 먼저 가져오는 경우\r\n  }\r\n  return { pageProps }; // component의 props\r\n};\r\n// =================================================================================\r\n\r\nconst configureStore = (initialState, options) => {\r\n  const sagaMiddleware = createSagaMiddleware();\r\n  const middlewares = [sagaMiddleware];\r\n  const enhancer = process.env.NODE_ENV === 'production' // 실제 서비스\r\n    ? compose(applyMiddleware(...middlewares))\r\n    : compose(\r\n      applyMiddleware(...middlewares),\r\n      !options.isServer && typeof window.__REDUX_DEVTOOLS_EXTENSION__ !== 'undefined' ? window.__REDUX_DEVTOOLS_EXTENSION__() : f => f,\r\n    );\r\n  const store = createStore(reducer, initialState, enhancer);\r\n  store.sagaTask = sagaMiddleware.run(rootSaga); // 서버사이드 렌더링할 때 store.sagaTask를 변수로 설정. withReduxSaga가 내부에서 필요로 함\r\n  return store;\r\n};\r\n\r\nexport default withRedux(configureStore)(withReduxSaga(NodeBird));\r\n\r\n// 레이아웃은 _app.js에서 코딩을 한다.\r\n"]},"metadata":{},"sourceType":"module"}